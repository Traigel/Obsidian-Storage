2025-02-23 18:51
Tags: #BroadcastChannelAPI

Этот API позволяет вкладкам одного происхождения (same-origin) обмениваться сообщениями в реальном времени, что делает его идеальным для синхронизации состояния между вкладками.

---

1. **Создание канала:**
    - Чтобы начать обмен сообщениями, нужно создать экземпляр `BroadcastChannel` с определенным именем канала.
    - Все вкладки, которые используют одно и то же имя канала, автоматически подключаются к нему и могут отправлять/получать сообщения.
```js
// Создаем канал с именем 'shared_state_channel'
const channel = new BroadcastChannel('shared_state_channel');
```

2. **Отправка сообщений:**
    - После создания канала, вы можете использовать метод `.postMessage(data)` для отправки данных другим участникам канала.
```js
// Отправляем состояние в канал
channel.postMessage({ count: 1, message: 'Hello from Tab 1' });
```

3. **Получение сообщений:**
    - Для получения сообщений необходимо добавить обработчик события `message` на канале.
```js
// Обрабатываем полученные сообщения
channel.onmessage = (event) => {
  console.log('Получено сообщение:', event.data);
};
```

4. **Закрытие канала:**
    - Когда канал больше не нужен, его можно закрыть с помощью метода `.close()`. Это освободит ресурсы.
```js
// Закрываем канал, когда он больше не нужен
channel.close();
```

---

### **Особенности Broadcast Channel API**

1. **Работа только в рамках одного происхождения (same-origin):**
    - Каналы доступны только для страниц с одинаковым доменом, протоколом и портом.
    
2. **Мгновенная доставка сообщений:**
    - Сообщения передаются сразу всем участникам канала, без задержек.
    
3. **Поддержка современных браузеров:**
    - Broadcast Channel поддерживается большинством современных браузеров, но не работает в IE и старых версиях Safari.
    
4. **Ограничения по размеру сообщений:**
    - Размер сообщений ограничен (обычно до нескольких мегабайт). Если нужно передавать большие объемы данных, лучше использовать другие методы (например, IndexedDB).
    
5. **Автоматическое закрытие канала:**
    - Если все участники канала закрыли свои соединения, канал автоматически уничтожается.

---
### Links
[[JavaScript]]
