2025-01-18 22:50
Tags: #auth #jwt #token

---

Это метод аутентификации, при котором вместо использования традиционной сессии на сервере, для подтверждения личности пользователя используется **токен** (например, JWT — JSON Web Token). Токен генерируется сервером после успешной аутентификации пользователя и передается клиенту. Клиент хранит этот токен и отправляет его при последующих запросах к серверу для получения доступа к защищенным ресурсам.

![[token_based.png]]

---

#### Принцип работы Token-Based Authentication:

1. **Аутентификация пользователя:**
    - Пользователь отправляет свои учетные данные (например, логин и пароль) на сервер.
    - Если данные правильные, сервер генерирует токен, обычно с ограниченным временем жизни (например, 1 час).
    - Токен включает информацию о пользователе и его правах, зашифрованную в безопасном формате (например, с использованием секретного ключа).
2. **Отправка токена клиенту:**
    - Токен отправляется обратно клиенту (например, в ответе на HTTP-запрос).
    - Клиент сохраняет токен в локальном хранилище (например, `localStorage`, `sessionStorage` или в cookie).
3. **Использование токена:**
    - При выполнении последующих запросов к серверу, клиент добавляет токен в заголовки запроса (обычно в заголовок `Authorization` как `Bearer <token>`).
4. **Проверка токена на сервере:**
    - Сервер проверяет токен, декодируя его и проверяя подпись с использованием секретного ключа.
    - Если токен действителен, сервер предоставляет доступ к запрашиваемому ресурсу.
    - Если токен отсутствует или недействителен (например, просрочен), сервер возвращает ошибку.
5. **Истечение срока действия (Expiration):**
    - Большинство токенов имеют срок действия. Когда срок действия истекает, клиент должен заново пройти процесс аутентификации для получения нового токена.

---

#### Преимущества Token-Based Authentication:

- **Безопасность:** Токены не требуют хранения сессионных данных на сервере, что уменьшает риск утечек данных.
- **Масштабируемость:** Токены могут быть использованы в распределенных системах, поскольку серверы не должны хранить информацию о сессиях.
- **Гибкость:** Токены легко передавать между различными сервисами, включая мобильные приложения, веб-приложения и сторонние API.
- **Статeless:** Сервер не хранит состояние сессии, что упрощает масштабирование.

---

#### Недостатки Token-Based Authentication:

- **Управление сроком действия токенов:** Требуется логика для обновления токенов или их аннулирования.
- **Безопасность хранения токенов:** Хранение токенов в локальном хранилище или cookie должно быть безопасным, чтобы избежать кражи токенов.

---

## JWT

Это обычная закодирована строка которая состоит из трёх частей:
- **Header** (заголовок) - определяет то как должна вычисляться подпись, определяет алгоритм хеширования
- **Payload** (Полезные данные) - храниться полезные данные, может быть id пользователя, его роли, userName... любые данные.
- **Signature** (Подпись) - шифруются данные и по этому ключу сервер сможет расшифровать эти данные.

![[JWT.jpg]]

#### Есть два вида токенов:
- Access - токен доступа
- Refresh - перезаписывает access токен

![[JWT_token.jpg]]



---
### Links
[[Auth]]
